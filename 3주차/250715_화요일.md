# 2025-07-14 월요일

## 데이터 시각화

### plotly

```python
import plotly.io as pio # Plotly input output
import plotly.express as px # 빠르게 그리는 방법 bar(title="기대수명")
import plotly.graph_objects as go # 디테일한 설정
import plotly.figure_factory as ff # 템플릿 불러오기 - 좀더 복잡한 모듈을 남이 만들어놓은대로 쓸 수 있어서
from plotly.subplots import make_subplots # subplot 만들기
# from plotly.validators.scatter.marker import SymbolValidator # Symbol 꾸미기에 사용됨
from plotly.validator_cache import ValidatorCache

SymbolValidator = ValidatorCache.get_validator("scatter.marker", "symbol")
```

```python
fig = dict({
    "data": [{"type": "bar",
              'x': ['1', '2', '3'],
              'y': [1, 3, 2]}],
    "layout": {"title": {"text": "딕셔너리로 그린 그래프"}} # 제목을 제시하려면?
})

# 한글 관련 설정을 구구절절 하지 않아도 지원합니다!!! 너무 편하고 좋죠!!!

# To display the figure defined by this dict, use the low-level plotly.io.show function
pio.show(fig)
```

```python
import plotly.express as px
data_canada = px.data.gapminder().query("country == 'Canada'")
fig = px.bar(data_canada, x='year', y='pop',title='캐나다')
fig.show()
```

```python
# 또 일단 하나 만들고 시작합니다!
tips = px.data.tips()

fig1 = px.scatter(tips, # 데이터명(데이터프레임 형식)
                 x='tip', # x축에 들어갈 컬럼
                 y='total_bill', # y축에 들어갈 컬럼
                 color='sex', # 색상 구분 기준이 될 컬럼명 (seaborn의 hue와 같은 역할)
                 marginal_x = 'box', # scatterplot의 옵션 중 하나인 인접 그래프의 스타일 지정 (히스토그램)
                 marginal_y = 'histogram',# scatterplot의 옵션 중 하나인 인접 그래프의 스타일 지정 (히스토그램)
                 trendline="ols",  # x축과 y축으로 지정된 데이터에 대해서 회귀분석(ols로)
                 trendline_color_override="grey",  # trendline 색상 지정
                 hover_name='day', # 팝업 데이터 최상단에 데이터프레임 컬럼명
                 hover_data=['day', 'size'], # 참고할 데이터 추가 - tips.columns로 설정하면 다 보여줌
                 title='Tips by Total Bill - Scatter Plot', # 그래프 타이틀 지정
                 width=1000,  # 그래프의 크기 조절
                 height=600)
fig1.show()
```

```python
fig2 = go.Figure(

    # data 파트는 데이터에 관한 정보를 지정
    data=[go.Histogram(name ='Tips per Size',  # 데이터 제목
                 x=tips['size'],  # x축 값 해당 컬럼명
                 y=tips['tip'],  # y축 값 해당 컬럼명
                 hoverlabel = dict(bgcolor = 'white'),  # 마우스를 올렸을 때 뜨는 정보창의 배경 설정
                ),
         ],

    # layout 파트에서 그래프의 축, 범례 등 부가정보 기입.
    layout=go.Layout(
        title='Tips 데이터 분석',  # 메인 타이틀 입력
        xaxis=dict(  # x축 설정
            title = '팁금액과 방문인원수',
            tickfont_size=10),
        yaxis=dict(  # y축 설정
            title= '전체 금액',
            tickfont_size=10),
        bargroupgap=0.3, # 그래프 간의 거리 조절
        autosize=True))


fig2.show()
```

```python
fig = px.scatter(iris,x = 'petal_width', y = 'petal_length', color = 'species_id') # species_id 는 숫자로서의 의미가 없는 명목형 변수
fig.show()
```

```python
fig = px.scatter(iris, x='petal_width', y='petal_length', color='species',
                 hover_data=['sepal_width'], # 참고할 데이터 추가 - iris.columns로 설정하면 다 보여줌
                 title='Iris Data - Scatter Plot',  # 그래프 타이틀 지정
                 symbol = iris['species_id'], # 마커 모양 지정 https://plotly.com/python/marker-style/
                 symbol_sequence= ['circle-open', 'circle', 'circle-open-dot'], # 마커 모양 지정
                 color_discrete_sequence = ['blue', 'orange', 'green']) # 마커 컬러 지정
fig.show()
```

```python
import plotly.graph_objects as go

fig = go.Figure(data=go.Scatter( # x축 값을 생략한 경우 DataFrame의 Index에 의해 배치됨
    y = iris['sepal_length'], # y축 값 sepal_length 값에 따라 배치
    mode='markers', # Scatter Plot을 그리기 위해 Markers
    marker=dict(    # Marker에 대한 세부 설정을 지정
        size=20,    # 점 크기
        color=iris['petal_length'], # 색깔 값을 petal_length에 따라 변하도록 설정
        colorscale='Viridis', # one of plotly colorscales
        showscale=True,  # colorscales 보여줌
        line_width=1, # 마커 라인 두께 설정
    )
))
fig.update_layout(title='Iris Data')
fig.show()
```

```python
# 퍼센트(%, 상대적인 크기)와 퍼센트포인트(%p, 절대적인 크기)의 차이
# 기존 강화성공률이 50% '성공률 50% 증가'
# 100% ??
import math

before = 60
end = 70

# 퍼센트포인트
percent_point = end - before

# 퍼센트
percent = (end-before) / before * 100
print(f'{percent_point}, {percent}')

# 로그스케일로 값 변화 : 절대적 크기가 얼마나 바뀌건 간에 '배수'로 값을 표현
log_change = math.log(end) - math.log(before)
print(f'퍼센트포인트: {percent_point} / 퍼센트 : {percent}% / 로그변화량 {log_change}')
```

```python
import pandas as pd
import numpy as np
import yfinance as yf

samsung = yf.download('005930.KS',
                      start='2015-07-14',
                      end='2025-07-15',
                      progress=False)

samsung = samsung.reset_index()

# samsung['Date'] = pd.to_datetime(samsung['day']) # 다른 모듈을 사용해서 날짜를 날짜로 인식하지 않고 string으로 인식할 때 써주시면 됩니다.

samsung
```

```python
canada = gapminder[gapminder['country']=='Canada']

fig = px.bar(canada,
              x="year",
              y="pop",
              title='Life expectancy in Canada',
             hover_data = ['gdpPercap','iso_num']
              )
fig.show()
```

```python
px.histogram(tips,x='sex',y='total_bill',histfunc='avg') # sum, avg, count, min, max
# histfunc로 원하는 값 선택 가능
```

```python
import plotly.figure_factory as ff
import numpy as np

# Add histogram data
x1 = np.random.randn(200)-2
x2 = np.random.randn(200)
x3 = np.random.randn(200)+2
x4 = np.random.randn(200)+4

# Group data together
hist_data = [x1, x2, x3, x4]

group_labels = ['Group 1', 'Group 2', 'Group 3', 'Group 4']

# Create distplot with custom bin_size
fig = ff.create_distplot(hist_data, group_labels, bin_size=[.1, .25, .5, 1])
fig.show()
```

```python
import plotly.express as px
df = px.data.tips()
fig = px.box(df, y="total_bill")
fig.show()
```

```python
import plotly.express as px
df = px.data.tips()
fig = px.violin(df, y="total_bill")
fig.show()
```

```python
import plotly.express as px
df = px.data.gapminder().query("year == 2007").query("continent == 'Americas'")
fig = px.pie(df, values='pop', names='country',
             title='Population of American continent',
             hover_data=['lifeExp'], labels={'lifeExp':'life expectancy'})
fig.update_traces(textposition='inside', textinfo='percent+label')
fig.show()
```

```python
import plotly.express as px
df = px.data.tips()
fig = px.treemap(df, path=[px.Constant("all"), 'sex', 'day', 'time'],
                 values='total_bill', color='time',
                  color_discrete_map={'(?)':'lightgrey', 'Lunch':'gold', 'Dinner':'darkblue'})
fig.update_layout(margin = dict(t=50, l=25, r=25, b=25))
fig.show()
```

```python
import plotly.express as px
import numpy as np
df = px.data.gapminder().query("year == 2007")
fig = px.sunburst(df, path=['continent', 'country'], values='pop',
                  color='lifeExp', hover_data=['iso_alpha'],
                  color_continuous_scale='RdBu',
                  color_continuous_midpoint=np.average(df['lifeExp'], weights=df['pop']))
fig.show()
```

```python
import plotly.figure_factory as ff
import numpy as np
np.random.seed(1)

X = np.random.rand(15, 12) # 15 samples, with 12 dimensions each
fig = ff.create_dendrogram(X)
fig.update_layout(width=800, height=500)
fig.show()
```

```python
# 위도(latitude)와 경도(longitude)로 데이터를 지도 위에 표시

import plotly.express as px
import pandas as pd

# 샘플 데이터
data = pd.DataFrame({
    "city": ["Seoul", "Tokyo", "Beijing"],
    "lat": [37.5665, 35.6895, 39.9042],
    "lon": [126.9780, 139.6917, 116.4074],
    "population_mil": [9.7, 14, 100]
})

print(data.head(3))

# scatter_geo
fig = px.scatter_geo(
    data,
    lat="lat",
    lon="lon",
    text="city",            # 마커에 도시 이름 표시
    size="population_mil",  # 마커 크기를 인구에 맞게 표시
    projection="orthographic",

    title="East Asia Major Cities",
    color='city'
)

# 중심 좌표를 서울로 이동
fig.update_geos(
    center={"lat": 37.5665, "lon": 126.9780},
    projection_rotation={"lon": 126.9780},  # 회전 중심 조정
)

fig.show()

```

## 오늘의 포인트
- matplotlib과 다른 인터랙티브한 시각화 도구이므로 더 자주 사용할 것
- 어떤 종류가 있는지만 파악하고 쓸 때는 공식문서 참고하기
